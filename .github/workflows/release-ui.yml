name: Release UI

on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
      - "ui-v*" # Push events to matching v*, i.e. v1.0, v20.15.10

jobs:
  build:
    env:
      PUPPETEER_SKIP_DOWNLOAD: 'true'
    runs-on: ubuntu-latest
    permissions: write-all

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - name: Checkout source
      uses: actions/checkout@v2
    
    - name: Install dependencies
      run: |
        npm i pnpm@^8.6.9 -g
        cd packages/ui
        pnpm i --force

    - name: Build
      run: |
        cd packages/ui
        node ./scripts/github-ci-build.mjs
      
    - name: Create Release
      uses: ncipollo/release-action@v1
      with:
        artifacts: "packages/ui/dist/*.zip,packages/ui/dist/*.exe,packages/ui/dist/*.deb,packages/ui/dist/*.rpm"
        tag: ${{ github.ref }}
        token: ${{ secrets.GITHUB_TOKEN }}
        body: TODO New Release.
